@startuml
' C4 Level 2 — Containers (updated with tech stack)
!includeurl https://raw.githubusercontent.com/plantuml-stdlib/C4-PlantUML/master/C4_Container.puml
LAYOUT_WITH_LEGEND()

title Notifications System — Containers (L2, FastAPI + MySQL)

Person(user, "Użytkownik")

System_Boundary(sys, "System powiadomień") {
  Container(mobile, "Flutter Mobile App", "Dart/Flutter", "UI, routing, Provider, FCM, lokalne notyfikacje")
  ContainerDb(localdb, "Local Storage", "SharedPreferences", "Cache/ustawienia (np. dark mode)")
  Container(api, "Backend REST API", "Python / FastAPI", "Obsługa /notifications, /auth/google")
  ContainerDb(db, "Database", "MySQL", "Powiadomienia, użytkownicy, status 'sent'")
  Container(scheduler, "Scheduler", "APScheduler", "Sprawdza zaległe powiadomienia i wysyła do FCM")
  Container_Ext(auth, "Google Sign-In", "OAuth 2.0 (idToken)", "Logowanie użytkownika")
  Container_Ext(fcm, "Firebase Cloud Messaging", "HTTP v1 API", "Dostarczanie push do urządzeń")
}

Rel(user, mobile, "Interakcja")
Rel(mobile, api, "GET/POST", "HTTPS/JSON (http)")
Rel(mobile, auth, "Sign-in (Google)")
Rel(mobile, localdb, "Odczyt/Zapis", "SharedPreferences")

Rel(api, db, "SQL", "mysql-connector-python")
Rel(scheduler, db, "SQL — pobiera zaległe")
Rel(scheduler, api, "Wywołuje logikę wysyłki (wewnętrznie)")
Rel(api, fcm, "Wysyła wiadomości", "HTTP v1 (service account)")
Rel(fcm, mobile, "Powiadomienia push")

SHOW_LEGEND()
@enduml